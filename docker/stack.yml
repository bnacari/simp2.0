services:
  simp20-php:
    image: "${DOCKER_IMAGE_TAG}"
    labels:
      - "br.com.cesan.app=${CI_PROJECT_NAME}"
      - "io.portainer.accesscontrol.teams=adm"
    environment:
      - DB_HOST=${DB_HOST}
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASS=${DB_PASS}
      - http_proxy=http://cntlm:3128/
      - https_proxy=http://cntlm:3128/
      - HTTP_PROXY=http://cntlm:3128/
      - HTTPS_PROXY=http://cntlm:3128/
    ports:
      - 9461:80
    volumes:
      - /etc/localtime:/etc/localtime:ro
    networks:
      - frontend
      - cntlm
    deploy:
      mode: replicated
      resources:
        limits:
          cpus: '2'
          memory: 4192M
 
  # cronjob:
  #   image: registry.cesan.com.br/library/curlimages/curl:8.8.0
  #   labels:
  #     - "br.com.cesan.app=${CI_PROJECT_NAME}"
  #     - "io.portainer.accesscontrol.teams=adm"
  #   volumes:
  #     - /etc/localtime:/etc/localtime:ro
  #   networks:
  #     - frontend
    # command: "http://simp20-php/api.php"
    # deploy:
    #   mode: replicated
    #   replicas: 0
    #   restart_policy:
    #     condition: none
    #   labels:
    #     - "swarm.cronjob.enable=true"
    #     - "swarm.cronjob.schedule=${CRONJOB_SCHEDULE}"
    #     - "swarm.cronjob.skip-running=false"
      # resources:
      #   limits:
      #     cpus: '2'
      #     memory: 1024M
networks:
  cntlm:
    name: backing-services_cntlm
    external: true
  frontend: